# Spring Boot september 2024, 2024-11-12

## Bestelling Applicatie
* [https://github.com/corbroekhuis/bestelling-app-jdbc.git](https://github.com/corbroekhuis/bestelling-app-jdbc.git)


<br/><br/>
<br/><br/>

### Gebruikte RestTemplate methodes staan hier beschreven
* [https://techsphere.dev/a-guide-to-spring-resttemplate](https://techsphere.dev/a-guide-to-spring-resttemplate)
* [https://docs.spring.io/spring-android/docs/current/reference/html/rest-template.html](https://docs.spring.io/spring-android/docs/current/reference/html/rest-template.html)
<br/><br/>
<br/><br/>
<br/><br/>
<br/><br/>
<br/><br/>
<br/><br/>

#### <a id="top"></a>
### Index:
* [Create tabel Bestellingen](#bestellingen)
* [Properties](#properties)
* [Form Authentication](#form-authentication)

<br/><br/>
<br/><br/>
<br/><br/>
<br/><br/>

## <a id="bestellingen"></a>Create Tabel Bestellingen

```SQL
DROP TABLE IF EXISTS bestellingen;
CREATE TABLE bestellingen(
   id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000000) PRIMARY KEY,
   artikel_id BIGINT NOT NULL,
   aantal  INT NOT NULL,
   datum TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO bestellingen ( artikel_id, aantal, datum) VALUES
(1000000, 3, {ts '2024-11-11 18:47:52.69'}),
(1000001, 2, {ts '2024-11-10 18:47:52.69'}),
(1000002, 1, {ts '2024-11-09 18:47:52.69'}),
(1000003, 3, {ts '2024-11-11 18:47:52.69'}),
(1000004, 1, {ts '2024-11-07 18:47:52.69'});

```

* [Top](#top)
## <a id="properties"></a>Properties


```properties
# Default: 8080
server.port=8080

ean.aansluitnummer=11999
fixed-delay.in.milliseconds=40000
spring.application.name=voorraad-app

spring.h2.console.enabled=true
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.url=jdbc:h2:file:C:/Temp/bestelling
spring.datasource.username=sa
spring.datasource.password=sa
# jpa, niet meer nodig
# spring.jpa.hibernate.ddl-auto=create

```

<br/><br/>
<br/><br/>
* [Top](#top)

## <a id="form-authentication"></a>Form Authentication

```java

package com.warehouse.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;

import static org.springframework.security.config.Customizer.withDefaults;

@Configuration
@EnableWebMvc
public class FormAuthConfig {

    @Bean
    public UserDetailsService userDetailsService() {
        UserDetails user1 =
                User.builder()
                        .username("user")
                        .password(passwordEncoder().encode("user"))
                        .roles("USER")
                        .build();
        UserDetails user2 =
                User.builder()
                        .username("admin")
                        .password(passwordEncoder().encode("admin"))
                        .roles("USER", "ADMIN")
                        .build();
        return new InMemoryUserDetailsManager(user1, user2);
    }

@Bean
BCryptPasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}

@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {

    http.headers(header -> header.frameOptions(options -> options.sameOrigin()));
    http.csrf(csrf -> csrf.disable())
            .authorizeHttpRequests(auth -> auth
                    .requestMatchers("/"
                            , "/h2-console/**"
                            , "/v2/api-docs"
                            , "/configuration/ui"
                            , "/swagger-resources/**"
                            , "/configuration/security"
                            , "/swagger-ui/**"
                            , "/webjars/**"
                    ).permitAll()
                    .requestMatchers("/api").authenticated()
                    .anyRequest().authenticated()
            )
        .formLogin(withDefaults());

        return http.build();
    }

}

```


<br/><br/>
<br/><br/>
* [Top](#top)

## <a id="encode"></a>Create token from user and password 

```java
    public static String getBasicAuth( String user, String password){

        StringBuilder sb = new StringBuilder("Basic ");

        String token = Base64.getUrlEncoder().encodeToString(  ( user + ":" + password).getBytes());
        sb.append( token);
        System.out.println( sb);

        return sb.toString();
    }
```

<br><br>
<br><br>
* [Top](#top)